# EXTREMELY IMPORTANT: Beans Usage Guide for Agents

This project uses **beans**, an agentic-first issue tracker. Issues are called "beans", and you can
use the "beans" CLI to manage them.

**Whenever you're tempted to use the TodoWrite or similar tool to organize work, consider using beans instead.**

All commands support --json for machine-readable output. Use this flag to parse responses easily.

## CRITICAL: Track All Work With Beans

**BEFORE starting any task the user asks you to do:**

1. FIRST: Create a bean with `beans create "Title" -t <type> -d "Description..." -s in-progress`
2. THEN: Do the work
3. FINALLY: Mark completed with `beans update <bean-id> --status completed`
4. IF and WHEN you COMMIT: Include both your code changes AND the bean file(s) in the commit!

If you identify something that should be changed or fixed after completing the user's request, create a new bean for that work instead of doing it immediately.

## Core Rules

- **Use `beans query` for flexible data access** - Supports both queries and mutations via GraphQL
- **CLI commands are simpler for common operations** - `beans create` and `beans update` are easier for single mutations
- After compaction or clear, run `beans prime` to re-sync
- Lean towards using sub-agents for interacting with beans

## Finding work

Use GraphQL to query for actionable beans (not completed, not draft, not blocked):

```bash
beans query '{ beans(filter: { excludeStatus: ["completed", "scrapped", "draft"], isBlocked: false }) { id title status type priority } }'
```

Other useful queries:

```bash
# All beans with basic info
beans query '{ beans { id title status type priority } }'

# Find high-priority bugs
beans query '{ beans(filter: { type: ["bug"], priority: ["critical", "high"] }) { id title status body } }'

# Search by text (uses Bleve query syntax)
beans query '{ beans(filter: { search: "authentication" }) { id title } }'
```

## Working on a bean

1. **Read the bean** using GraphQL to get full details:
   ```bash
   beans query '{ bean(id: "<id>") { title status type body parent { title } children { title status } } }'
   ```
2. **Mark as in-progress**: `beans update <bean-id> --status in-progress`
3. Adhere to the instructions in the bean's body when working on it

**If the bean has a checklist:**

1. Work through items in order (unless dependencies require otherwise)
2. **After completing each checklist item**, immediately update the bean file to mark it done:
   - Change `- [ ]` to `- [x]` for the completed item
3. When committing code changes, include the updated bean file with checked-off items
4. Re-read the bean periodically to stay aware of remaining work

## Relationships

Beans can have relationships to other beans. Use these to express dependencies and hierarchy.

**Parent (single value):**
- `parent` - assigns a bean to a parent bean (type-restricted hierarchy: milestone → epic → feature → task/bug)

**Blocking (multiple values):**
- `blocking` - this bean is blocking another bean (prevents work on the blocked bean until this one is done)

**Managing relationships (CLI):**

- `beans update <bean-id> --parent <other-id>` - Set the parent
- `beans update <bean-id> --remove-parent` - Remove the parent
- `beans update <bean-id> --blocking <other-id>` - Add a blocking relationship
- `beans update <bean-id> --remove-blocking <other-id>` - Remove a blocking relationship

**Querying relationships (GraphQL):**

```bash
# Get a bean with its relationships
beans query '{ bean(id: "abc") { title parent { id title } children { id title status } blockedBy { title } blocking { title } } }'

# Find beans blocked by something
beans query '{ beans(filter: { isBlocked: true }) { id title blockedBy { title } } }'

# Find top-level beans (no parent)
beans query '{ beans(filter: { noParent: true }) { id title type } }'
```

## Creating new beans

- `beans create --help`
- Example: `beans create "Fix login bug" -t bug -d "Users cannot log in when..." -s todo`
- **Always specify a type with `-t`**. See the "Issue Types" section below for available types and their descriptions.
- When creating a new bean, first see if a similar bean already exists.
- When creating new beans, include a useful description. If you're not sure what to write, ask the user.
- Make the description as detailed as possible, similar to a plan that you would create for yourself.
- If possible, split the work into a checklist of GitHub-Formatted-Markdown tasks. Use a `## Checklist` header to precede it.

## Cleaning up beans

- `beans archive` will archive (delete) beans marked as completed or scrapped. ONLY run this when I explicitly tell you to.

## GraphQL Reference

The `beans query` command executes GraphQL queries. This is the preferred way to read bean data.

**Command flags:**

- `--json`: Output raw JSON (no formatting)
- `--schema`: Print the GraphQL schema
- `-v, --variables`: Query variables as JSON string
- `-o, --operation`: Operation name for multi-operation documents

**Tips:**

```bash
# Read query from stdin (useful for complex queries or shell escaping)
beans query <<'EOF'
{ beans(filter: { type: ["bug"], excludeStatus: ["completed"] }) { id title priority } }
EOF

# Create a new bean
beans query 'mutation { createBean(input: { title: "Fix bug", type: "bug", status: "todo" }) { id title } }'

# Update a bean's status
beans query 'mutation { updateBean(id: "beans-abc", input: { status: "completed" }) { id status } }'

# Set a bean's parent
beans query 'mutation { setParent(id: "beans-abc", parentId: "beans-xyz") { id parent { title } } }'

# Print the full schema for reference
beans query --schema
```

**GraphQL Schema:**

```graphql
{{.GraphQLSchema}}```

## Issue Types

This project has the following issue types configured. Always specify a type with `-t` when creating beans:
{{range .Types}}
- **{{.Name}}**{{if .Description}}: {{.Description}}{{end}}
{{- end}}

## Statuses

This project has the following statuses configured:
{{range .Statuses}}
- **{{.Name}}**{{if .Description}}: {{.Description}}{{end}}
{{- end}}

## Priorities

Beans can have an optional priority. Use `-p` when creating or `--priority` when updating:
{{range .Priorities}}
- **{{.Name}}**{{if .Description}}: {{.Description}}{{end}}
{{- end}}

Beans without a priority are treated as `normal` priority for sorting purposes.
